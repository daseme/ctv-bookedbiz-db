{% extends "base.html" %}

{% block title %}Management Performance Report (Nord) - CTV Booked Biz{% endblock %}
{% block header_title %}Management Performance Report{% endblock %}
{% block header_subtitle %}Executive Dashboard - {{ current_year }} Performance Analysis (Nord Theme){% endblock %}

{% block breadcrumb %}
<span class="breadcrumb-separator">›</span>
<span class="breadcrumb-current">Management Performance Report (Nord)</span>
{% endblock %}

{% block extra_styles %}
<!-- Nord Theme Foundation -->
<style>
/* Nord Color Palette */
:root {
    /* Nord Polar Night */
    --nord0: #2e3440;
    --nord1: #3b4252;
    --nord2: #434c5e;
    --nord3: #4c566a;
    
    /* Nord Snow Storm */
    --nord4: #d8dee9;
    --nord5: #e5e9f0;
    --nord6: #eceff4;
    
    /* Nord Frost */
    --nord7: #8fbcbb;  /* Frost Teal */
    --nord8: #88c0d0;  /* Frost Light Blue */
    --nord9: #81a1c1;  /* Frost Blue */
    --nord10: #5e81ac; /* Frost Dark Blue */
    
    /* Nord Aurora */
    --nord11: #bf616a; /* Aurora Red */
    --nord12: #d08770; /* Aurora Orange */
    --nord13: #ebcb8b; /* Aurora Yellow */
    --nord14: #a3be8c; /* Aurora Green */
    --nord15: #b48ead; /* Aurora Purple */
    
    /* Semantic Variables */
    --bg-primary: var(--nord6);
    --bg-secondary: var(--nord5);
    --bg-tertiary: var(--nord4);
    --text-primary: var(--nord0);
    --text-secondary: var(--nord3);
    --text-muted: var(--nord3);
    --border-color: var(--nord4);
    --shadow-color: rgba(46, 52, 64, 0.1);
    
    /* Accent Colors */
    --accent-executive: var(--nord10);
    --accent-success: var(--nord14);
    --accent-warning: var(--nord13);
    --accent-danger: var(--nord11);
    --accent-info: var(--nord8);
}

/* Override base styles for Nord theme */
body {
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    color: var(--text-primary);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

/* Nord Navigation Bar Override */
.top-nav {
    background: linear-gradient(135deg, var(--nord0) 0%, var(--nord1) 100%) !important;
    box-shadow: 0 2px 4px rgba(46, 52, 64, 0.3) !important;
}

.main-nav {
    background: var(--bg-secondary) !important;
    border-top: 1px solid var(--nord7) !important;
}

.nav-section-label {
    color: var(--nord4) !important;
}

.nav-section.executive .nav-section-label { 
    color: var(--nord8) !important; 
}
.nav-section.operational .nav-section-label { 
    color: var(--nord14) !important; 
}
.nav-section.market .nav-section-label { 
    color: var(--nord15) !important; 
}
.nav-section.admin .nav-section-label { 
    color: var(--nord11) !important; 
}

.nav-section:hover .nav-section-label,
.nav-section.active .nav-section-label {
    color: var(--nord6) !important;
}

.nav-section.executive:hover .nav-section-label,
.nav-section.executive.active .nav-section-label {
    border-bottom-color: var(--nord8) !important;
}
.nav-section.operational:hover .nav-section-label,
.nav-section.operational.active .nav-section-label {
    border-bottom-color: var(--nord14) !important;
}
.nav-section.market:hover .nav-section-label,
.nav-section.market.active .nav-section-label {
    border-bottom-color: var(--nord15) !important;
}
.nav-section.admin:hover .nav-section-label,
.nav-section.admin.active .nav-section-label {
    border-bottom-color: var(--nord11) !important;
}

.container {
    background: var(--bg-primary);
    box-shadow: 0 4px 20px var(--shadow-color);
    border: 1px solid var(--border-color);
}

.header {
    background: linear-gradient(135deg, var(--nord6) 0%, rgba(255,255,255,0.8) 100%);
    border-bottom: 2px solid var(--border-color);
    backdrop-filter: blur(8px);
}

.header h1 {
    color: var(--text-primary);
    font-weight: 600;
    letter-spacing: -0.025em;
}

.header .subtitle {
    color: var(--text-secondary);
}

/* Nord Management Report Styles */
.nord-management-report {
    max-width: 1200px;
    margin: 0 auto;
    background: var(--bg-primary);
}

.nord-export-actions {
    text-align: right;
    margin-bottom: 24px;
}

.nord-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
    backdrop-filter: blur(8px);
    border: 1px solid transparent;
}

.nord-btn-primary {
    background: linear-gradient(135deg, var(--accent-executive), var(--nord9));
    color: white;
    box-shadow: 0 2px 8px rgba(94, 129, 172, 0.3);
}

.nord-btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(94, 129, 172, 0.4);
}

.nord-btn-secondary {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border-color: var(--border-color);
    margin-left: 12px;
}

.nord-btn-secondary:hover {
    background: var(--bg-tertiary);
    border-color: var(--text-muted);
}

.nord-report-header {
    background: linear-gradient(135deg, var(--accent-executive) 0%, var(--nord9) 100%);
    color: white;
    padding: 32px;
    border-radius: 12px;
    margin-bottom: 32px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 8px 32px rgba(94, 129, 172, 0.2);
    position: relative;
    overflow: hidden;
}

.nord-report-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="80" cy="40" r="0.5" fill="rgba(255,255,255,0.03)"/><circle cx="40" cy="80" r="1.5" fill="rgba(255,255,255,0.04)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    pointer-events: none;
}

.nord-report-title {
    font-size: 28px;
    font-weight: 700;
    margin: 0;
    letter-spacing: -0.025em;
    z-index: 1;
    position: relative;
}

.nord-report-logo {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(4px);
    z-index: 1;
    position: relative;
}

.nord-performance-section {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 24px;
    box-shadow: 0 4px 20px var(--shadow-color);
    backdrop-filter: blur(8px);
}

.nord-section-title {
    font-size: 22px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 24px 0;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.nord-section-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--accent-executive), var(--nord9));
    border-radius: 8px;
    color: white;
    font-size: 16px;
}

.nord-overview-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
}

.nord-stat-card {
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    padding: 24px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid var(--border-color);
    box-shadow: 0 2px 12px var(--shadow-color);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.nord-stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-executive), var(--nord9));
}

.nord-stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 32px var(--shadow-color);
}

.nord-stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--accent-executive);
    margin-bottom: 8px;
    font-variant-numeric: tabular-nums;
}

.nord-stat-label {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 12px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.nord-stat-change {
    font-size: 13px;
    font-weight: 500;
    padding: 4px 8px;
    border-radius: 6px;
    display: inline-block;
}

.nord-stat-change.positive {
    color: var(--accent-success);
    background: rgba(163, 190, 140, 0.1);
}

.nord-stat-change.negative {
    color: var(--accent-danger);
    background: rgba(191, 97, 106, 0.1);
}

.nord-performance-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-top: 20px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 12px var(--shadow-color);
}

.nord-performance-table th {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    padding: 16px 12px;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 2px solid var(--border-color);
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.nord-performance-table th.number {
    text-align: right;
}

.nord-performance-table td {
    padding: 16px 12px;
    border-bottom: 1px solid var(--border-color);
    background: var(--bg-primary);
}

.nord-performance-table td.number {
    text-align: right;
    font-variant-numeric: tabular-nums;
    font-weight: 500;
}

.nord-performance-table tr.total {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
    font-weight: 600;
}

.nord-performance-table tr.total td {
    border-top: 2px solid var(--border-color);
    background: transparent;
}

.nord-progress-bar {
    width: 100%;
    height: 28px;
    background: var(--bg-tertiary);
    border-radius: 14px;
    border: 1px solid var(--border-color);
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(46, 52, 64, 0.1);
}

.nord-progress-fill {
    height: 100%;
    background: linear-gradient(135deg, var(--accent-executive), var(--nord9));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
    font-weight: 600;
    transition: width 0.6s ease;
    position: relative;
    overflow: hidden;
}

.nord-ae-section {
    margin-top: 32px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .nord-report-header {
        flex-direction: column;
        text-align: center;
        gap: 20px;
        padding: 24px;
    }
    
    .nord-overview-stats {
        grid-template-columns: 1fr;
    }
    
    .nord-performance-table {
        font-size: 14px;
    }
    
    .nord-performance-table th,
    .nord-performance-table td {
        padding: 12px 8px;
    }
    
    .nord-stat-value {
        font-size: 24px;
    }
}
</style>

<!-- Google Fonts for better typography -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="nord-management-report">
    
    <!-- Export Actions -->
    <div class="nord-export-actions">
        <button onclick="window.print()" class="nord-btn nord-btn-primary">
            <span>🖨️</span> Print Report
        </button>
        <button onclick="window.print()" class="nord-btn nord-btn-secondary">
            <span>🖨️</span> Print Report
        </button>
    </div>
    
    <!-- Report Header -->
    <div class="nord-report-header">
        <h1 class="nord-report-title">Management Performance Report</h1>
        <img src="{{ url_for('static', filename='logo.png') }}" alt="CTV Logo" class="nord-report-logo">
    </div>

    <!-- Company Performance Section -->
    <div class="nord-performance-section">
        <h2 class="nord-section-title">
            <span class="nord-section-icon">📊</span>
            Company Performance
        </h2>
        
        <div class="nord-overview-stats">
            <div class="nord-stat-card">
                <div class="nord-stat-label">Total Revenue</div>
                <div class="nord-stat-value">${{ total_revenue }}</div>
                {% if total_previous_year_revenue_raw|float > 0 %}
                <div class="nord-stat-change {{ total_year_over_year_change|float >= 0 and 'positive' or 'negative' }}">
                    vs ${{ total_previous_year_revenue }} last year 
                    ({{ total_year_over_year_change|float >= 0 and '+' or '' }}{{ '%0.1f' | format(total_year_over_year_change|float) }}%)
                </div>
                {% endif %}
            </div>
            
            <div class="nord-stat-card">
                <div class="nord-stat-label">Total Customers</div>
                <div class="nord-stat-value">{{ total_customers }}</div>
                {% if previous_year_customers|int > 0 %}
                <div class="nord-stat-change {{ total_customers|int > previous_year_customers|int and 'positive' or 'negative' }}">
                    vs {{ previous_year_customers }} last year 
                    ({{ ((total_customers|int - previous_year_customers|int) / previous_year_customers|int * 100) | round(1) }}%)
                </div>
                {% endif %}
            </div>
            
            <div class="nord-stat-card">
                <div class="nord-stat-label">Total Budget</div>
                <div class="nord-stat-value">${{ company_total_budget }}</div>
                <div class="nord-stat-change">
                    {{ company_completion_percentage }}% Complete
                </div>
            </div>
        </div>

        <!-- Quarterly Performance Table -->
        <h3 style="color: var(--text-primary); margin: 32px 0 20px 0; font-weight: 600;">Quarterly Performance</h3>
        <table class="nord-performance-table">
            <thead>
                <tr>
                    <th>Quarter</th>
                    <th>Budget Pacing</th>
                    <th class="number">Booked</th>
                    <th class="number">YoY Change</th>
                    <th class="number">Pipeline</th>
                    <th class="number">Budget</th>
                </tr>
            </thead>
            <tbody>
                {% for quarter in company_quarters %}
                <tr>
                    <td style="font-weight: 500;">{{ quarter.name }}</td>
                    <td>
                        <div class="nord-progress-bar">
                            <div class="nord-progress-fill" style="width: {{ quarter.completion_percentage }}%;">
                                {{ quarter.completion_percentage }}%
                            </div>
                        </div>
                    </td>
                    <td class="number">${{ quarter.booked }}</td>
                    <td class="number">
                        <span class="nord-stat-change {{ quarter.year_over_year_change|float >= 0 and 'positive' or 'negative' }}" style="font-size: 12px;">
                            {% if quarter.previous_year_booked_raw|float > 0 %}
                                {{ quarter.year_over_year_change|float >= 0 and '+' or '' }}{{ '%0.1f' | format(quarter.year_over_year_change|float) }}%
                            {% else %}
                                --
                            {% endif %}
                        </span>
                    </td>
                    <td class="number">${{ quarter.pipeline }}</td>
                    <td class="number">${{ quarter.budget }}</td>
                </tr>
                {% endfor %}
                <tr class="total">
                    <td style="font-weight: 700;">Annual Total</td>
                    <td>
                        <div class="nord-progress-bar">
                            <div class="nord-progress-fill" style="width: {{ company_completion_percentage }}%;">
                                {{ company_completion_percentage }}%
                            </div>
                        </div>
                    </td>
                    <td class="number">${{ total_revenue }}</td>
                    <td class="number">
                        <span class="nord-stat-change {{ total_year_over_year_change|float >= 0 and 'positive' or 'negative' }}" style="font-size: 12px;">
                            {% if total_previous_year_revenue|float > 0 %}
                              {{ total_year_over_year_change|float >= 0 and '+' or '' }}{{ '%0.1f' | format(total_year_over_year_change|float) }}%
                            {% else %}
                              New
                            {% endif %}
                        </span>
                    </td>
                    <td class="number">${{ total_pipeline_revenue }}</td>
                    <td class="number">${{ company_total_budget }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Individual AE Performance Sections -->
    {% for ae in ae_data %}
    <div class="nord-performance-section nord-ae-section">
        <h2 class="nord-section-title">
            <span class="nord-section-icon">👤</span>
            {{ ae.name }}'s Performance
        </h2>
        
        <div class="nord-overview-stats">
            <div class="nord-stat-card">
                <div class="nord-stat-label">Total Revenue</div>
                <div class="nord-stat-value">${{ ae.total_booked_revenue }}</div>
                {% if ae.previous_year_revenue_raw|float > 0 %}
                <div class="nord-stat-change {{ ae.year_over_year_change|float >= 0 and 'positive' or 'negative' }}">
                    vs ${{ ae.previous_year_revenue_display }} last year 
                    ({{ ae.year_over_year_change|float >= 0 and '+' or '' }}{{ '%0.1f' | format(ae.year_over_year_change|float) }}%)
                </div>
                {% endif %}
            </div>
            
            <div class="nord-stat-card">
                <div class="nord-stat-label">Total Customers</div>
                <div class="nord-stat-value">{{ ae.total_customers }}</div>
                {% if ae.previous_year_customers|int > 0 %}
                <div class="nord-stat-change {{ ae.total_customers|int > ae.previous_year_customers|int and 'positive' or 'negative' }}">
                    vs {{ ae.previous_year_customers }} last year
                    {% if ae.previous_year_customers|int > 0 %}
                        ({{ ((ae.total_customers|int - ae.previous_year_customers|int) / ae.previous_year_customers|int * 100) | round(1) }}%)
                    {% endif %}
                </div>
                {% endif %}
            </div>
            
            <div class="nord-stat-card">
                <div class="nord-stat-label">Total Budget</div>
                <div class="nord-stat-value">${{ ae.total_budget }}</div>
                <div class="nord-stat-change {{ ae.total_completion_percentage|int >= 75 and 'positive' or (ae.total_completion_percentage|int >= 50 and 'neutral' or 'negative') }}">
                    {{ ae.total_completion_percentage }}% Complete
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

</div>
{% endblock %} 