<!-- src/web/templates/customer_normalization_manager.html -->
{% extends "base.html" %}

{% block title %}Customer Normalization Audit - CTV Reports{% endblock %}
{% block header_title %}Customer Normalization Audit{% endblock %}
{% block header_subtitle %}Raw bill codes → canonical normalized names (IAS + Branded Content); PROD/PRODUCTION stripped{% endblock %}

{% block extra_styles %}
<style>
  .norm-wrap{display:flex;flex-direction:column;gap:16px}
  .stats-bar{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
  .stat{padding:12px;border:1px solid #e2e8f0;border-radius:8px;background:#fff}
  .stat .v{font-size:20px;font-weight:700}
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .controls input,.controls select{padding:8px 10px;border:1px solid #cbd5e1;border-radius:6px}
  .table-container{border:1px solid #e2e8f0;border-radius:8px;overflow:auto;max-height:70vh;background:#fff}
  table{width:100%;border-collapse:separate;border-spacing:0}
  thead th{position:sticky;top:0;background:#f8fafc;border-bottom:1px solid #e2e8f0;padding:10px;text-align:left;font-weight:600}
  tbody td{border-bottom:1px solid #f1f5f9;padding:8px;vertical-align:top;white-space:nowrap}
  .badge{padding:2px 8px;border-radius:999px;border:1px solid #cbd5e1;font-size:12px}
  .ok{background:#ecfdf5;border-color:#34d399}
  .warn{background:#fff7ed;border-color:#f59e0b}
  .err{background:#fef2f2;border-color:#ef4444}
  .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .pagination{display:flex;justify-content:space-between;align-items:center;padding:8px}
  .pagination button{padding:8px 12px;border:1px solid #cbd5e1;border-radius:6px;background:#fff;cursor:pointer}
  .sticky-first thead th:first-child,
  .sticky-first tbody td:first-child{position:sticky;left:0;background:#fff;z-index:1}
  .dim{color:#64748b}
</style>
{% endblock %}

{% block content %}
<div class="norm-wrap">
  <div class="stats-bar">
    <div class="stat"><div class="v" id="s-total">-</div><div class="dim">Total rows</div></div>
    <div class="stat"><div class="v" id="s-exists">-</div><div class="dim">In customers</div></div>
    <div class="stat"><div class="v" id="s-ias">-</div><div class="dim">Seen: Internal Ad Sales</div></div>
    <div class="stat"><div class="v" id="s-bc">-</div><div class="dim">Seen: Branded Content</div></div>
    <div class="stat"><div class="v" id="s-conflicts">-</div><div class="dim">Alias conflicts</div></div>
  </div>

  <div class="controls">
    <input id="q" placeholder="Search raw/normalized/customer…" style="min-width:280px">
    <select id="status">
      <option value="all">All statuses</option>
      <option value="exists">In customers</option>
      <option value="missing">Missing in customers</option>
      <option value="conflict">Alias conflicts</option>
    </select>
    <select id="rev">
      <option value="all">All rev types</option>
      <option value="IAS">Internal Ad Sales</option>
      <option value="BC">Branded Content</option>
    </select>
    <select id="sort">
      <option value="raw_az">Raw A→Z</option>
      <option value="raw_za">Raw Z→A</option>
      <option value="norm_az">Normalized A→Z</option>
      <option value="norm_za">Normalized Z→A</option>
      <option value="status">Status</option>
      <option value="rev">Revenue Type</option>
      <option value="created_desc">Recently Created</option>
    </select>
    <select id="size">
      <option>25</option><option>50</option><option>100</option><option>200</option>
    </select>
    <button id="btn-refresh">Refresh</button>
    <button id="btn-export">Export CSV</button>
  </div>

  <div class="table-container">
    <table class="sticky-first" id="grid">
      <thead>
        <tr>
          <th style="min-width:340px">Raw</th>
          <th style="min-width:340px">Normalized</th>
          <th style="min-width:220px">Customer</th>
          <th style="min-width:220px">Agency 1</th>
          <th style="min-width:220px">Agency 2</th>
          <th style="min-width:200px">Revenue Types Seen</th>
          <th style="min-width:160px">Status</th>
          <th style="min-width:160px">Customer ID</th>
          <th style="min-width:160px">Created</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="9" class="dim">Loading…</td></tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <div id="page-info" class="dim">–</div>
    <div>
      <button id="prev">← Prev</button>
      <button id="next">Next →</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/customer-normalization-manager.js') }}"></script>
{% endblock %}
