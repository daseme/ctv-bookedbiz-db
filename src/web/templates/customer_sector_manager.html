{% extends "base.html" %}

{% block title %}Customer & Sector Management - CTV Booked Biz{% endblock %}

{% block content %}
<div class="container">
    <div class="content-wrapper">
        <div class="header">
            <h1>Customer & Sector Management</h1>
            <div class="subtitle">Interactive database management interface</div>
        </div>
        
        <!-- Stats Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
            <div style="background: white; border: 2px solid #e5e9f0; border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; font-weight: 700; color: #2e3440;" id="total-customers">0</div>
                <div style="font-size: 14px; color: #4c566a; text-transform: uppercase;">Total Customers</div>
            </div>
            <div style="background: white; border: 2px solid #e5e9f0; border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; font-weight: 700; color: #2e3440;" id="assigned-customers">0</div>
                <div style="font-size: 14px; color: #4c566a; text-transform: uppercase;">Assigned</div>
            </div>
            <div style="background: white; border: 2px solid #e5e9f0; border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; font-weight: 700; color: #2e3440;" id="unassigned-customers">0</div>
                <div style="font-size: 14px; color: #4c566a; text-transform: uppercase;">Unassigned</div>
            </div>
            <div style="background: white; border: 2px solid #e5e9f0; border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; font-weight: 700; color: #2e3440;" id="total-sectors">0</div>
                <div style="font-size: 14px; color: #4c566a; text-transform: uppercase;">Active Sectors</div>
            </div>
        </div>

        <!-- Customer Table -->
        <div style="background: white; border: 2px solid #e5e9f0; border-radius: 12px; overflow: hidden;" id="table-container">
            <div style="text-align: center; padding: 40px; color: #4c566a;">
                Loading customer data...
            </div>
        </div>

        <!-- Notification Area -->
        <div id="notification" style="display: none; position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 8px; font-weight: 600; z-index: 1000;"></div>
    </div>
</div>

<script>
// Customer data (we'll load this dynamically)
let customers = [
    { id: 1, name: "Acme Corporation", sector: "Technology", lastUpdated: "2025-01-15" },
    { id: 2, name: "Blue Industries Ltd", sector: "Manufacturing", lastUpdated: "2025-01-14" },
    { id: 3, name: "Green Solutions Inc", sector: "Environmental", lastUpdated: "2025-01-13" },
    { id: 4, name: "TechFlow Systems", sector: "Technology", lastUpdated: "2025-01-12" },
    { id: 5, name: "HealthTech Partners", sector: null, lastUpdated: "2025-01-11" },
    { id: 6, name: "Metro Construction Co", sector: "Construction", lastUpdated: "2025-01-10" },
    { id: 7, name: "Sunrise Media Group", sector: null, lastUpdated: "2025-01-09" },
    { id: 8, name: "Atlantic Financial", sector: "Financial Services", lastUpdated: "2025-01-08" }
];

const sectors = [
    { id: 1, name: "Technology", color: "#88c0d0" },
    { id: 2, name: "Manufacturing", color: "#d08770" },
    { id: 3, name: "Environmental", color: "#a3be8c" },
    { id: 4, name: "Construction", color: "#b48ead" },
    { id: 5, name: "Financial Services", color: "#5e81ac" }
];

function updateStats() {
    document.getElementById('total-customers').textContent = customers.length;
    document.getElementById('assigned-customers').textContent = customers.filter(c => c.sector).length;
    document.getElementById('unassigned-customers').textContent = customers.filter(c => !c.sector).length;
    document.getElementById('total-sectors').textContent = sectors.length;
}

function renderTable() {
    let tableHtml = `
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #eceff4;">
                    <th style="padding: 15px; text-align: left; font-weight: 600; color: #2e3440; border-bottom: 1px solid #e5e9f0;">Customer Name</th>
                    <th style="padding: 15px; text-align: left; font-weight: 600; color: #2e3440; border-bottom: 1px solid #e5e9f0;">Current Sector</th>
                    <th style="padding: 15px; text-align: left; font-weight: 600; color: #2e3440; border-bottom: 1px solid #e5e9f0;">Quick Assign</th>
                    <th style="padding: 15px; text-align: left; font-weight: 600; color: #2e3440; border-bottom: 1px solid #e5e9f0;">Status</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    customers.forEach(customer => {
        const sector = sectors.find(s => s.name === customer.sector);
        const sectorColor = sector ? sector.color : '#ebcb8b';
        const sectorText = customer.sector || 'Unassigned';
        
        let sectorOptions = '<option value="">Unassigned</option>';
        sectors.forEach(s => {
            const selected = customer.sector === s.name ? 'selected' : '';
            sectorOptions += `<option value="${s.name}" ${selected}>${s.name}</option>`;
        });
        
        tableHtml += `
            <tr style="border-bottom: 1px solid #e5e9f0;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor=''">
                <td style="padding: 15px; font-weight: 600; color: #2e3440;">${customer.name}</td>
                <td style="padding: 15px;">
                    <span style="padding: 6px 12px; background: ${sectorColor}; color: ${customer.sector ? 'white' : '#2e3440'}; border-radius: 6px; font-size: 12px; font-weight: 600;">
                        ${sectorText}
                    </span>
                </td>
                <td style="padding: 15px;">
                    <select onchange="updateCustomerSector(${customer.id}, this.value)" style="padding: 8px 12px; border: 2px solid #e5e9f0; border-radius: 6px; background: white; font-size: 14px;">
                        ${sectorOptions}
                    </select>
                </td>
                <td style="padding: 15px; font-size: 14px;">
                    ${customer.sector ? 
                        '<span style="color: #a3be8c;">✓ Assigned</span>' : 
                        '<span style="color: #ebcb8b;">⚠ Needs Assignment</span>'
                    }
                </td>
            </tr>
        `;
    });
    
    tableHtml += '</tbody></table>';
    document.getElementById('table-container').innerHTML = tableHtml;
}

function updateCustomerSector(customerId, newSector) {
    // Update the customer data
    customers = customers.map(customer => 
        customer.id === customerId 
            ? { ...customer, sector: newSector || null, lastUpdated: new Date().toISOString().split('T')[0] }
            : customer
    );
    
    // Update display
    updateStats();
    renderTable();
    showNotification(`Customer sector updated to ${newSector || 'Unassigned'}!`);
}

function showNotification(message) {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.style.display = 'block';
    notification.style.background = '#d4edda';
    notification.style.color = '#155724';
    notification.style.border = '1px solid #c3e6cb';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('Customer Sector Manager initializing...');
    updateStats();
    renderTable();
    console.log('Interface ready!');
});
</script>
{% endblock %}